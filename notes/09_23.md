# Meeting Notes

not using openocd is a problem, cant assume if it works but or1ksim that it is going to work with openOCD

think about stripping down openOCD to only contain functionalities for gecko5education.

DDD quite nice graphical interface, it is cross platform ? openOCD for sure is.

maybe there's a plugin for VS Code that does that. specifically for GDB. likely that there's one already

START WITH dummy debug controler that answers dummy values. dummy state machine for memory reads for instance

GDB for or1200 should work fine decompiling or1300 instructions.


TODO

1/ 
get the setup for last semester project running with GDB. last years student used a CLI to send instructions to the JTAG interface, now needs to use GDB.
- try and understand the way openOCD transforms GDB commands into JTAG commands

another possibility: "rewriting" openOCD to understand GDB protocol and translate it into JTAG

GDB is absolutely given 


- last years semester project setup working
- compare the packets when using GDB vs telnet. hopefully some of the work can be done only using the ipcore and memory access
- moving to gdb
- write a dummy debug controler

dummy controler that supports a very barebones software

length of two chains // length of data register should be hardcoded in openOCD driver directly. usually stored in """BSD files""" ???

---------------

convert_32 program takes in the .elf file and generates the CMEM file.
CMEM file contains read-only and read-write sections writen in ACSII, because of limitation of the serial connection

utility would not be needed anymore if we move to JTAG for uploading files.

---------------

2/ look for frontend alternative (DDD) ? maybe one for vs code.

# Work Done

## Getting last years semester project running

Re installed cs476 toolchain and oss-cad-suite to synthesize design.
Synthesized and uploaded VP to fpga.
Can either connect through telnet to send custom jtag commands to FPGA or use the provided program

### Opening OpenOCD server

```bash
openocd -f config.cfg
```

### Communicating with FPGA

Writing to memory
```bash
jules@jules-ubuntu:............$ ./jtag_interface -w -addr 0x000100 -bs 4 -s 10
Connected to OpenOCD Tcl server at 127.0.0.1:4444
Transaction setup complete with address 0x000100 and burst size 3
Enter a 32-bit hex value (without 0x prefix): deadbeef
Enter a 32-bit hex value (without 0x prefix): b00b5111
Enter a 32-bit hex value (without 0x prefix): deadbeef
Enter a 32-bit hex value (without 0x prefix): deadbeef
Enter a 32-bit hex value (without 0x prefix): deadbeef
Enter a 32-bit hex value (without 0x prefix): deadbeef
Enter a 32-bit hex value (without 0x prefix): eeeeeeee
Enter a 32-bit hex value (without 0x prefix): eeeeeeee
Enter a 32-bit hex value (without 0x prefix): ffffffff
Enter a 32-bit hex value (without 0x prefix): eeeeeeee
```

Reading from memory
```bash
jules@jules-ubuntu:..........$ ./jtag_interface -r -addr 0x000100 -bs 4 -s 10
Connected to OpenOCD Tcl server at 127.0.0.1:4444
Transaction setup complete with address 0x000100 and burst size 3
0x00000100 : 	0xdeadbeef
0x00000104 : 	0xb00b5111
0x00000108 : 	0xdeadbeef
0x0000010c : 	0xdeadbeef
0x00000110 : 	0xdeadbeef
0x00000114 : 	0xdeadbeef
0x00000118 : 	0xeeeeeeee
0x0000011c : 	0xeeeeeeee
0x00000120 : 	0xffffffff
0x00000124 : 	0xeeeeeeee
```

MVP component: `jtag_support` 
`jtag_interface.v` interfaces the lattice PFGA (JTAGG module, its builtin) and the `jtag_support` module
`jtag_support.v` interfaces JTAG (through ipcore and pingpongbuffer) and access to internal components (dma)

## Problem

Problem: using telnet to connect to openOCD does not make use of the GDB remote serial protocol of course

## OpenOCD docs

TODO
- Find how GDB RSP commands are translated into JTAG commands.
- Find how JTAG commands are processed physically by the JTAGG impl of FPGA

JTAG commands include
```bash
irscan <tap_name> <instruction> # readwrite to jtag instruction register
drscan <tap_name> <size> <data> # readwrite to jtag data register
pathmove <tap_state_name>       # move tap controler to said state
runtest <nb_cycles>             # run N cycles of TAP controler FSM
```

