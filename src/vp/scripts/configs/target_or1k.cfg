# /opt/oss-cad-suite/share/openocd/scripts/target/or1k.cfg
# SPDX-License-Identifier: GPL-2.0-or-later

set  _ENDIAN big

if { [info exists CHIPNAME] } {
   set _CHIPNAME $CHIPNAME
} else {
   set _CHIPNAME or1k
}

#if { [info exists TAP_TYPE] } {
#   set _TAP_TYPE $TAP_TYPE
#} else {
#   puts "You need to select a tap type"
#   shutdown
#}

# Configure the target
# JTAG TAP ID of Lattice FPGA. FPGA JTAG TAP used as CPU TAP as well
set _CPUTAPID  0x41113043

jtag newtap $_CHIPNAME cpu \
   -irlen 8 -irmask 0x83 -ircapture 0x1 \
   -expected-id $_CPUTAPID

set _TARGETNAME $_CHIPNAME.cpu
target create $_TARGETNAME or1k -endian $_ENDIAN -chain-position $_TARGETNAME

# Select the TAP core we are using
# Custom TAP implemented with the right JTAG chain ID
tap_select gecko

# Select the debug unit core we are using. This debug unit as an option.

#set ADBG_USE_HISPEED            1
#set ENABLE_JSP_SERVER           2
#set ENABLE_JSP_MULTI            4
set ADBG_USE_HISPEED 0
set ENABLE_JSP_SERVER 0
set ENABLE_JSP_MULTI 0

# If ADBG_USE_HISPEED is set (options bit 1), status bits will be skipped
# on burst reads and writes to improve download speeds.
# This option must match the RTL configured option.

du_select adv [expr {$ADBG_USE_HISPEED | $ENABLE_JSP_SERVER | $ENABLE_JSP_MULTI}]